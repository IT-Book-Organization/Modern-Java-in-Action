# Chapter 4. μ¤νΈλ¦Ό μ†κ°

<br/>

# 4.1 μ¤νΈλ¦Όμ΄λ€ λ¬΄μ—‡μΈκ°€?

`μ¤νΈλ¦Ό(Streams)`μ„ μ΄μ©ν•λ©΄ μ„ μ–Έν•μΌλ΅ μ»¬λ ‰μ…(collection) λ°μ΄ν„°λ¥Ό μ²λ¦¬ν•  μ μμΌλ©°, (μ¦‰, λ°μ΄ν„°λ¥Ό μ²λ¦¬ν•λ” μ„μ‹ κµ¬ν„ μ½”λ“λ¥Ό μ‘μ„±ν•λ” λ€μ‹  μ§μλ΅ ν‘ν„ν•  μ μκ² λ¨)  
λ©€ν‹°μ¤λ λ“ μ½”λ“λ¥Ό κµ¬ν„ν•μ§€ μ•μ•„λ„ λ°μ΄ν„°λ¥Ό **ν¬λ…ν•κ² λ³‘λ ¬λ΅** μ²λ¦¬ν•  μ μλ‹¤.

<br/>

e.g., μ €μΉΌλ΅λ¦¬μ μ”λ¦¬λ…μ„ λ°ν™ν•κ³ , μΉΌλ΅λ¦¬λ¥Ό κΈ°μ¤€μΌλ΅ μ”λ¦¬λ¥Ό μ •λ ¬ν•λ” μ½”λ“

- μλ°” 7 μ½”λ“

    ```java
    // μ €μΉΌλ΅λ¦¬ μ”λ¦¬λ“¤
    List<Dish> lowCaloricDishes = new ArrayList<>(); // κ°€λΉ„μ§€(garbage) λ³€μ : μ»¨ν…μ΄λ„ μ—­ν• λ§ ν•λ” μ¤‘κ°„ λ³€μ
    for(Dish dish : menu) { // λ„μ μλ΅ μ”μ† ν•„ν„°λ§
        if(dish.getCalories() < 400) {
            lowCaloricDishes.add(dish);
        }
    }
    
    // μµλ… ν΄λμ¤λ΅ μ”λ¦¬λ“¤μ„ μΉΌλ΅λ¦¬ κΈ°μ¤€μΌλ΅ μ •λ ¬
    Collections.sort(lowCaloricDishes, new Comparator<Dish>() {
        public int compare(Dish dish1, Dish dish2) {
            return Integer.compare(dish1.getCalories(), dish2.getCalories());
        }
    });
    
    List<String> lowCaloricDishesName = new ArrayList();
    for(Dish dish : lowCaloricDishes) {
        lowCaloricDishesName.add(dish.getName()); // μ •λ ¬λ λ¦¬μ¤νΈλ¥Ό μ²λ¦¬ν•λ©΄μ„ μ”λ¦¬ μ΄λ¦„ μ„ νƒ
    }
    ```

<br/>

- μ¤νΈλ¦Όμ„ μ‚¬μ©ν• μλ°” 8 μ½”λ“

    ```java
    import static java.util.Comparator.comparing;
    import static java.util.stream.Collectors.toList;
    List<String> lowCaloricDishesName = menu.stream()
    					.filter(d -> d.getCalories() < 400) // 400 μΉΌλ΅λ¦¬ μ΄ν•μ μ”λ¦¬ μ„ νƒ
    					.sorted(comparing(Dish::getCalories) // μΉΌλ΅λ¦¬λ΅ μ”λ¦¬ μ •λ ¬
    					.map(Dish::getName) // μ”λ¦¬λ… μ¶”μ¶
    					.collect(toList()); // λ¨λ“  μ”λ¦¬λ…μ„ λ¦¬μ¤νΈμ— μ €μ¥
    ```

  μ„μ μ½”λ“μ—μ„ stream()μ„ `parallelStream()`μΌλ΅ λ°”κΎΈλ©΄ μ΄ μ½”λ“λ¥Ό λ©€ν‹° μ½”μ–΄ μ•„ν‚¤ν…μ²μ—μ„ λ³‘λ ¬λ΅ μ‹¤ν–‰ν•  μ μλ‹¤.

<br/>

### μ¤νΈλ¦Όμ μ¥μ 

> `μ„ μ–Έν•`μΌλ΅ μ½”λ“λ¥Ό κµ¬ν„ν•  μ μλ‹¤.

μ„ μ–Έν• μ½”λ“μ™€ λ™μ‘ νλΌλ―Έν„°ν™”λ¥Ό ν†µν•΄μ„ λ³€ν•λ” μ”κµ¬μ‚¬ν•­μ— μ‰½κ² λ€μ‘ν•  μ μλ‹¤.

<br/>

> μ—¬λ¬ λΉλ”© λΈ”λ΅ μ—°μ‚°(filter, sorted, map, collect λ“±)μ„ μ—°κ²°ν•΄μ„ λ³µμ΅ν• **λ°μ΄ν„° μ²λ¦¬ νμ΄ν”„λΌμΈ**μ„ λ§λ“¤ μ μλ‹¤. (`μ΅°λ¦½ κ°€λ¥`)

μ—¬λ¬ μ—°μ‚°μ„ νμ΄ν”„λΌμΈμΌλ΅ μ—°κ²°ν•΄λ„ μ—¬μ „ν κ°€λ…μ„±κ³Ό λ…ν™•μ„±μ΄ μ μ§€λλ‹¤.

<br/>

> λ°μ΄ν„° μ²λ¦¬ κ³Όμ •μ„ `λ³‘λ ¬ν™”`ν•λ©΄μ„ μ¤λ λ“μ™€ λ½μ„ κ±±μ •ν•  ν•„μ”κ°€ μ—†μΌλ©°, μ„±λ¥μ΄ μΆ‹μ•„μ§„λ‹¤.

filter, sorted, map, collect κ°™μ€ μ—°μ‚°μ€ `κ³ μμ¤€ λΉλ”© λΈ”λ΅(high-level building block)`μΌλ΅ μ΄λ£¨μ–΄μ Έ μλ‹¤.

μ΄λ“¤μ€ νΉμ • μ¤λ λ”© λ¨λΈμ— μ ν•λμ§€ μ•κ³  μ–΄λ–¤ μƒν™©μ—μ„λ“  μμ λ΅­κ² μ‚¬μ©ν•  μ μλ‹¤.

<br/>
<br/>
<br/>

# 4.2 μ¤νΈλ¦Ό μ‹μ‘ν•κΈ°

## μ •μ

> π’΅ **λ°μ΄ν„° μ²λ¦¬ μ—°μ‚°**μ„ μ§€μ›ν•λ„λ΅ **μ†μ¤**μ—μ„ μ¶”μ¶λ **μ—°μ†λ μ”μ†** (Sequence of elements)

<br/>

### μ—°μ†λ μ”μ†

μ¤νΈλ¦Όμ€ μ»¬λ ‰μ…κ³Ό λ§μ°¬κ°€μ§€λ΅ νΉμ • μ”μ† ν•μ‹μΌλ΅ μ΄λ£¨μ–΄μ§„ μ—°μ†λ κ°’ μ§‘ν•©μ μΈν„°νμ΄μ¤λ¥Ό μ κ³µν•λ‹¤.

ν•μ§€λ§ μ»¬λ ‰μ…μ μ£Όμ λ” λ°μ΄ν„°κ³ , μ¤νΈλ¦Όμ μ£Όμ λ” κ³„μ‚°μ΄λ‹¤. (4.3μ μ—μ„ μμ„Έν λ‹¤λ£Έ)

<br/>

### μ†μ¤

μ¤νΈλ¦Όμ€ λ°μ΄ν„° μ κ³µ μ†μ¤(e.g., μ»¬λ ‰μ…, λ°°μ—΄, I/O μμ› λ“±)λ΅λ¶€ν„° λ°μ΄ν„°λ¥Ό μ†λΉ„ν•λ‹¤.

**μ •λ ¬λ μ»¬λ ‰μ…μΌλ΅ μ¤νΈλ¦Όμ„ μƒμ„±ν•λ©΄ μ •λ ¬μ΄ κ·Έλ€λ΅ μ μ§€λλ‹¤.**

<br/>

### λ°μ΄ν„° μ²λ¦¬ μ—°μ‚°

filter, map, reduce, find, match, sort λ“±μΌλ΅ λ°μ΄ν„°λ¥Ό μ΅°μ‘ν•  μ μμΌλ©°,  
μ¤νΈλ¦Ό μ—°μ‚°μ€ μμ°¨μ μΌλ΅ λλ” λ³‘λ ¬λ΅ μ‹¤ν–‰ν•  μ μλ‹¤.

<br/>
<br/>

## μ£Όμ” νΉμ„±

### νμ΄ν”„λΌμ΄λ‹(pipelining)

λ€λ¶€λ¶„μ μ¤νΈλ¦Ό μ—°μ‚°μ€ **μ¤νΈλ¦Ό μμ‹ μ„ λ°ν™**ν•λ‹¤.

λ”°λΌμ„ μ¤νΈλ¦Ό μ—°μ‚°λΌλ¦¬ μ—°κ²°ν•΄μ„ νμ΄ν”„λΌμΈμ„ κµ¬μ„±ν•  μ μμΌλ©°,  
λ•λ¶„μ— `κ²μΌλ¦„(laziness)`, `μ‡ΌνΈμ„ν‚·(short-circuiting)` κ°™μ€ μµμ ν™”λ„ μ–»μ„ μ μλ‹¤. (5μ¥μ—μ„ μ„¤λ…ν•¨)

<br/>

### λ‚΄λ¶€ λ°λ³µ

λ°λ³µμλ¥Ό μ΄μ©ν•΄μ„ λ…μ‹μ μΌλ΅ λ°λ³µν•λ” μ»¬λ ‰μ…κ³Ό λ‹¬λ¦¬, μ¤νΈλ¦Όμ€ λ‚΄λ¶€ λ°λ³µμ„ μ§€μ›ν•λ‹¤. (4.3.2μ μ—μ„ μ„¤λ…ν•¨)

<br/>
<br/>


> μ¤νΈλ¦Ό λΌμ΄λΈλ¬λ¦¬μ—μ„ ν•„ν„°λ§(fliter), μ¶”μ¶(map), μ¶•μ†(limit) κΈ°λ¥μ„ μ κ³µν•λ―€λ΅ **μ§μ ‘ κΈ°λ¥μ„ κµ¬ν„ν•  ν•„μ”κ°€ μ—†μΌλ©°**,  
> κ²°κ³Όμ μΌλ΅ μ¤νΈλ¦Ό APIλ” νμ΄ν”„λΌμΈμ„ λ” μµμ ν™”ν•  μ μλ” **μ μ—°μ„±**μ„ μ κ³µν•λ‹¤.

<br/>
<br/>
<br/>

# 4.3 μ¤νΈλ¦Όκ³Ό μ»¬λ ‰μ…

μλ°”μ κΈ°μ΅΄ `μ»¬λ ‰μ…`κ³Ό μƒλ΅μ΄ `μ¤νΈλ¦Ό` λ¨λ‘ μ—°μ†λ(sequenced, μμ°¨μ μΈ) μ”μ† ν•μ‹μ κ°’μ„ μ €μ¥ν•λ” μλ£κµ¬μ΅°μ μΈν„°νμ΄μ¤λ¥Ό μ κ³µν•λ‹¤.

<br/>

> π’΅ λ°μ΄ν„°λ¥Ό **μ–Έμ ** κ³„μ‚°ν•λλƒκ°€ λ‘μ κ°€μ¥ ν° μ°¨μ΄λ‹¤.

- `μ»¬λ ‰μ…` : ν„μ¬ μλ£κµ¬μ΅°κ°€ ν¬ν•¨ν•λ” **λ¨λ“ ** κ°’μ„ λ©”λ¨λ¦¬μ— μ €μ¥ν•λ” μλ£κµ¬μ΅°
    - μ»¬λ ‰μ…μ λ¨λ“  μ”μ†λ” μ»¬λ ‰μ…μ— μ¶”κ°€ν•κΈ° μ „μ— κ³„μ‚°λμ–΄μ•Ό ν•λ‹¤.


- `μ¤νΈλ¦Ό` : **μ”μ²­ν•  λ•λ§ μ”μ†λ¥Ό κ³„μ‚°**ν•λ” κ³ μ •λ μλ£κµ¬μ΅° (= κ²μΌλ¥΄κ² λ§λ“¤μ–΄μ§€λ” μ»¬λ ‰μ…)
    - μ‚¬μ©μκ°€ μ”μ²­ν•λ” κ°’λ§ μ¤νΈλ¦Όμ—μ„ μ¶”μ¶ν•λ‹¤.
    - μƒμ‚°μ(producer)μ™€ μ†λΉ„μ(consumer) κ΄€κ³„λ¥Ό ν•μ„±ν•λ‹¤.

<br/>
<br/>

## 4.3.1 λ”± ν• λ²λ§ νƒμƒ‰ν•  μ μλ‹¤

μ¤νΈλ¦Όμ€ λ°λ³µμμ™€ λ§μ°¬κ°€μ§€λ΅ ν• λ²λ§ νƒμƒ‰ν•  μ μλ‹¤.

**μ¦‰, νƒμƒ‰λ μ¤νΈλ¦Όμ μ”μ†λ” μ†λΉ„λλ‹¤.**

<br/>

ν• λ² νƒμƒ‰ν• μ”μ†λ¥Ό λ‹¤μ‹ νƒμƒ‰ν•λ ¤λ©΄ μ΄κΈ° λ°μ΄ν„° μ†μ¤μ—μ„ μƒλ΅μ΄ μ¤νΈλ¦Όμ„ λ§λ“¤μ–΄μ•Ό ν•λ”λ°,  
μ΄λ¥Ό μ„ν•΄μ„λ” μ»¬λ ‰μ…μ²λΌ λ°λ³µ μ‚¬μ©ν•  μ μλ” λ°μ΄ν„° μ†μ¤μ—¬μ•Ό ν•λ‹¤.

<br/>

μ•„λ μμ‹μ²λΌ λ°μ΄ν„° μ†μ¤κ°€ I/O μ±„λ„μΌ κ²½μ°, μ†μ¤λ¥Ό λ°λ³µ μ‚¬μ©ν•  μ μ—†μΌλ―€λ΅ μƒλ΅μ΄ μ¤νΈλ¦Όμ„ λ§λ“¤ μ μ—†λ‹¤.

```java
List<String> title = Arrays.asList("Java8","In","Action");
Stream<String> s = title.stream();
s.forEach(System.out::println); // titleμ κ° λ‹¨μ–΄λ¥Ό μ¶λ ¥
s.forEach(System.out::println); // IllegalStateException: μ¤νΈλ¦Όμ΄ μ΄λ―Έ μ†λΉ„λμ—κ±°λ‚ λ‹«ν
```

<br/>
<br/>

## 4.3.2 μ™Έλ¶€ λ°λ³µκ³Ό λ‚΄λ¶€ λ°λ³µ

μ»¬λ ‰μ…κ³Ό μ¤νΈλ¦Όμ λ λ‹¤λ¥Έ μ°¨μ΄μ μ€ **λ°μ΄ν„° λ°λ³µ μ²λ¦¬ λ°©λ²•**μ΄λ‹¤.

<br/>

### μ»¬λ ‰μ… - μ™Έλ¶€ λ°λ³µ(external iteration)

- for-each λ“±μ„ μ‚¬μ©ν•΄μ„ μ‚¬μ©μκ°€ μ§μ ‘ μ”μ†λ¥Ό λ°λ³µν•΄μ•Ό ν•λ‹¤.
- e.g.,

    ```java
    List<String> names = new ArrayList<>();
    for(Dish dish : menu) { // λ©”λ‰΄ λ¦¬μ¤νΈλ¥Ό λ…μ‹μ μΌλ΅ μμ°¨ λ°λ³µν•¨
        names.add(dish.getName());
    }
    ```

<br/>

<p align="center"><img width="650" alt="α„‹α…¬α„‡α…® α„‡α…΅α†«α„‡α…©α†¨" src="https://user-images.githubusercontent.com/86337233/217856618-d74cce2c-adaa-46bc-ace5-fc37e762690a.png">

<br/>
<br/>

### μ¤νΈλ¦Ό - λ‚΄λ¶€ λ°λ³µ(internal iteration)

- λ°λ³µμ„ μ•μ•„μ„ μ²λ¦¬ν•κ³  κ²°κ³Ό μ¤νΈλ¦Όκ°’μ„ μ–΄λ”κ°€μ— μ €μ¥ν•΄μ¤€λ‹¤.
- e.g.,

    ```java
    List<String> names = menu.stream()
    		         .map(Dish::getName) // μ”λ¦¬λ…μ„ μ¶”μ¶ (map λ©”μ„λ“λ¥Ό getName λ©”μ„λ“λ΅ νλΌλ―Έν„°ν™”)
    			 .collect(toList()); // νμ΄ν”„λΌμΈμ„ μ‹¤ν–‰, λ°λ³µμλ” ν•„μ” μ—†μ
    ```

- μ‘μ—…μ„ ν¬λ…ν•κ² λ³‘λ ¬λ΅ μ²λ¦¬ν•κ±°λ‚ λ” μµμ ν™”λ λ‹¤μ–‘ν• μμ„λ΅ μ²λ¦¬ν•  μ μκ² λλ‹¤.
- μ¤νΈλ¦Ό λΌμ΄λΈλ¬λ¦¬μ λ‚΄λ¶€ λ°λ³µμ€ λ°μ΄ν„° ν‘ν„κ³Ό ν•λ“μ›¨μ–΄λ¥Ό ν™μ©ν• **λ³‘λ ¬μ„±** κµ¬ν„μ„ μλ™μΌλ΅ μ„ νƒν•λ‹¤.
    - μ™Έλ¶€ λ°λ³µμ—μ„λ” λ³‘λ ¬μ„±μ„ μ¤μ¤λ΅ κ΄€λ¦¬ν•΄μ•Ό ν•λ‹¤.

<br/>

<p align="center"><img width="650" alt="α„‚α…Άα„‡α…® α„‡α…΅α†«α„‡α…©α†¨" src="https://user-images.githubusercontent.com/86337233/217856613-4a6d5118-7775-4251-bd73-e43b2799f949.png">

<br/>
<br/>
<br/>
<br/>

# 4.4 μ¤νΈλ¦Ό μ—°μ‚°

μ¤νΈλ¦Ό μΈν„°νμ΄μ¤μ μ—°μ‚°μ€ ν¬κ² λ‘ κ°€μ§€λ΅ κµ¬λ¶„ν•  μ μλ‹¤.

1. `μ¤‘κ°„ μ—°μ‚°(intermediate operation)` : μ—°κ²°ν•  μ μλ” μ¤νΈλ¦Ό μ—°μ‚° (νμ΄ν”„λΌμΈμ„ ν•μ„±)
2. `μµμΆ… μ—°μ‚°(terminal operation)` : μ¤νΈλ¦Όμ„ λ‹«λ” μ—°μ‚°

<br/>

e.g.,

```java
List<String> names = menu.stream()
                         .filter(dish->dish.getCalories()>300) // μ¤‘κ°„ μ—°μ‚°
                         .map(Dish::getName) // μ¤‘κ°„ μ—°μ‚°
                         .limit(3) // μ¤‘κ°„ μ—°μ‚°
                         .collect(toList()); // μµμΆ… μ—°μ‚°
```

<br/>

<p align="center"><img width="650" alt="α„α…®α†Όα„€α…΅α†« α„‹α…§α†«α„‰α…΅α†«α„€α… α„α…¬α„α…©α†Ό α„‹α…§α†«α„‰α…΅α†«" src="https://user-images.githubusercontent.com/86337233/217856602-1954fe35-ccb8-4e0f-8371-9e62729bacb9.png">

<br/>
<br/>
<br/>

## 4.4.1 μ¤‘κ°„ μ—°μ‚°

μ—¬λ¬ μ¤‘κ°„ μ—°μ‚°μ„ μ—°κ²°ν•΄μ„ μ§μλ¥Ό λ§λ“¤ μ μλ‹¤.

<br/>

μ¤‘κ°„ μ—°μ‚°μ€ **κ²μΌλ¥΄λ‹¤(lazy)**.

λ‹¨λ§ μ—°μ‚°μ„ μ¤νΈλ¦Ό νμ΄ν”„λΌμΈμ— μ‹¤ν–‰ν•κΈ° μ „κΉμ§€λ” μ•„λ¬΄ μ—°μ‚°λ„ μν–‰ν•μ§€ μ•λ”λ‹¤.

> π’΅ μ¤‘κ°„ μ—°μ‚°μ„ ν•©μΉ λ‹¤μμ— **ν•©μ³μ§„ μ¤‘κ°„ μ—°μ‚°μ„ μµμΆ… μ—°μ‚°μΌλ΅ ν• λ²μ— μ²λ¦¬**ν•κΈ° λ•λ¬Έμ΄λ‹¤.


<br/>


e.g.,

```java
List<String> names = menu.stream()
                         .filter(dish->{
                             System.out.println("filtering:"+dish.getName());
                             return dish.getCalories()>300;
                         }) // ν•„ν„°λ§ν• μ”λ¦¬λ… μ¶λ ¥
                         .map(dish->{
                             System.out.println("mapping:"+dish.getName());
                             return dish.getName();
                         }) // μ¶”μ¶ν• μ”λ¦¬λ… μ¶λ ¥
                         .limit(3)
                         .collect(toList());
System.out.println(names);
```

<br/>

ν”„λ΅κ·Έλ¨ μ‹¤ν–‰ κ²°κ³Όλ” λ‹¤μκ³Ό κ°™λ‹¤.

```
filtering:pork
mapping:pork
filtering:beef
mapping:beef
filtering:chicken
mapping:chicken
[pork, beef, chicken]
```

<br/>

- `limit μ—°μ‚°`κ³Ό `μ‡ΌνΈμ„ν‚· κΈ°λ²•`(5μ¥μ—μ„ μ„¤λ…ν•¨) λ•λ¶„μ— 300 μΉΌλ΅λ¦¬κ°€ λ„λ” μ”λ¦¬λ” μ—¬λ¬ κ°μ§€λ§ **μ¤μ§ μ²μ 3κ°λ§ μ„ νƒλμ—λ‹¤.**


- `λ£¨ν”„ ν“¨μ „(loop fusion)` : filterμ™€ mapμ€ μ„λ΅ λ‹¤λ¥Έ μ—°μ‚°μ΄μ§€λ§ ν• κ³Όμ •μΌλ΅ λ³‘ν•©λμ—λ‹¤.

<br/>
<br/>

## 4.4.2 μµμΆ… μ—°μ‚°

μ¤νΈλ¦Ό μ΄μ© κ³Όμ •μ€ μ„Έ κ°€μ§€λ΅ μ”μ•½ν•  μ μλ‹¤.

- μ§μλ¥Ό μν–‰ν•  `λ°μ΄ν„° μ†μ¤` (e.g., μ»¬λ ‰μ…)
- μ¤νΈλ¦Ό νμ΄ν”„λΌμΈμ„ κµ¬μ„±ν•  `μ¤‘κ°„ μ—°μ‚°` μ—°κ²°
- μ¤νΈλ¦Ό νμ΄ν”„λΌμΈμ„ μ‹¤ν–‰ν•κ³  κ²°κ³Όλ¥Ό λ§λ“¤ `μµμΆ… μ—°μ‚°`
